<!DOCTYPE html>
<html style="display: none;" lang="en">
    <head>
    <meta charset="utf-8">
    <!--
        © Material Theme
        https://github.com/viosey/hexo-theme-material
        Version: 1.5.0 -->
    <script>
        window.materialVersion = "1.5.0"
        // Delete localstorage with these tags
        window.oldVersion = [
            'codestartv1',
            '1.3.4',
            '1.4.0',
            '1.4.0b1'
        ]
    </script>

    <!-- dns prefetch -->
    <meta http-equiv="x-dns-prefetch-control" content="on">


    <link rel="dns-prefetch" href="https://cdn1.lncld.net"/>













    <!-- Title -->
    
    <title>
        
            tcpdump实例 | 
        
        Jason
    </title>

    <!-- Meta & Info -->
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="format-detection" content="telephone=no"/>
    <meta name="theme-color" content="#0097A7">
    <meta name="author" content="Jason">
    <meta name="description" itemprop="description" content="">
    <meta name="keywords" content=",network">

    <!-- Import lsloader -->
    <script>(function(){window.lsloader={jsRunSequence:[],jsnamemap:{},cssnamemap:{}};lsloader.removeLS=function(key){try{localStorage.removeItem(key)}catch(e){}};lsloader.setLS=function(key,val){try{localStorage.setItem(key,val)}catch(e){}};lsloader.getLS=function(key){var val="";try{val=localStorage.getItem(key)}catch(e){val=""}return val};versionString="/*"+(window.materialVersion||"unknownVersion")+"*/";lsloader.clean=function(){try{var keys=[];for(var i=0;i<localStorage.length;i++){keys.push(localStorage.key(i))}keys.forEach(function(key){var data=lsloader.getLS(key);if(window.oldVersion){var remove=window.oldVersion.reduce(function(p,c){return p||data.indexOf("/*"+c+"*/")!==-1},false);if(remove){lsloader.removeLS(key)}}})}catch(e){}};lsloader.clean();lsloader.load=function(jsname,jspath,cssonload,isJs){if(typeof cssonload==="boolean"){isJs=cssonload;cssonload=undefined}isJs=isJs||false;cssonload=cssonload||function(){};var code;code=this.getLS(jsname);if(code&&code.indexOf(versionString)===-1){this.removeLS(jsname);this.requestResource(jsname,jspath,cssonload,isJs);return}if(code){var versionNumber=code.split(versionString)[0];if(versionNumber!=jspath){console.log("reload:"+jspath);this.removeLS(jsname);this.requestResource(jsname,jspath,cssonload,isJs);return}code=code.split(versionString)[1];if(isJs){this.jsRunSequence.push({name:jsname,code:code});this.runjs(jspath,jsname,code)}else{document.getElementById(jsname).appendChild(document.createTextNode(code));cssonload()}}else{this.requestResource(jsname,jspath,cssonload,isJs)}};lsloader.requestResource=function(name,path,cssonload,isJs){var that=this;if(isJs){this.iojs(path,name,function(path,name,code){that.setLS(name,path+versionString+code);that.runjs(path,name,code)})}else{this.iocss(path,name,function(code){document.getElementById(name).appendChild(document.createTextNode(code));that.setLS(name,path+versionString+code)},cssonload)}};lsloader.iojs=function(path,jsname,callback){var that=this;that.jsRunSequence.push({name:jsname,code:""});try{var xhr=new XMLHttpRequest;xhr.open("get",path,true);xhr.onreadystatechange=function(){if(xhr.readyState==4){if(xhr.status>=200&&xhr.status<300||xhr.status==304){if(xhr.response!=""){callback(path,jsname,xhr.response);return}}that.jsfallback(path,jsname)}};xhr.send(null)}catch(e){that.jsfallback(path,jsname)}};lsloader.iocss=function(path,jsname,callback,cssonload){var that=this;try{var xhr=new XMLHttpRequest;xhr.open("get",path,true);xhr.onreadystatechange=function(){if(xhr.readyState==4){if(xhr.status>=200&&xhr.status<300||xhr.status==304){if(xhr.response!=""){callback(xhr.response);cssonload();return}}that.cssfallback(path,jsname,cssonload)}};xhr.send(null)}catch(e){that.cssfallback(path,jsname,cssonload)}};lsloader.iofonts=function(path,jsname,callback,cssonload){var that=this;try{var xhr=new XMLHttpRequest;xhr.open("get",path,true);xhr.onreadystatechange=function(){if(xhr.readyState==4){if(xhr.status>=200&&xhr.status<300||xhr.status==304){if(xhr.response!=""){callback(xhr.response);cssonload();return}}that.cssfallback(path,jsname,cssonload)}};xhr.send(null)}catch(e){that.cssfallback(path,jsname,cssonload)}};lsloader.runjs=function(path,name,code){if(!!name&&!!code){for(var k in this.jsRunSequence){if(this.jsRunSequence[k].name==name){this.jsRunSequence[k].code=code}}}if(!!this.jsRunSequence[0]&&!!this.jsRunSequence[0].code&&this.jsRunSequence[0].status!="failed"){var script=document.createElement("script");script.appendChild(document.createTextNode(this.jsRunSequence[0].code));script.type="text/javascript";document.getElementsByTagName("head")[0].appendChild(script);this.jsRunSequence.shift();if(this.jsRunSequence.length>0){this.runjs()}}else if(!!this.jsRunSequence[0]&&this.jsRunSequence[0].status=="failed"){var that=this;var script=document.createElement("script");script.src=this.jsRunSequence[0].path;script.type="text/javascript";this.jsRunSequence[0].status="loading";script.onload=function(){that.jsRunSequence.shift();if(that.jsRunSequence.length>0){that.runjs()}};document.body.appendChild(script)}};lsloader.tagLoad=function(path,name){this.jsRunSequence.push({name:name,code:"",path:path,status:"failed"});this.runjs()};lsloader.jsfallback=function(path,name){if(!!this.jsnamemap[name]){return}else{this.jsnamemap[name]=name}for(var k in this.jsRunSequence){if(this.jsRunSequence[k].name==name){this.jsRunSequence[k].code="";this.jsRunSequence[k].status="failed";this.jsRunSequence[k].path=path}}this.runjs()};lsloader.cssfallback=function(path,name,cssonload){if(!!this.cssnamemap[name]){return}else{this.cssnamemap[name]=1}var link=document.createElement("link");link.type="text/css";link.href=path;link.rel="stylesheet";link.onload=link.onerror=cssonload;var root=document.getElementsByTagName("script")[0];root.parentNode.insertBefore(link,root)};lsloader.runInlineScript=function(scriptId,codeId){var code=document.getElementById(codeId).innerText;this.jsRunSequence.push({name:scriptId,code:code});this.runjs()};lsloader.loadCombo=function(jslist){var updateList="";var requestingModules={};for(var k in jslist){var LS=this.getLS(jslist[k].name);if(!!LS){var version=LS.split(versionString)[0];var code=LS.split(versionString)[1]}else{var version=""}if(version==jslist[k].path){this.jsRunSequence.push({name:jslist[k].name,code:code,path:jslist[k].path})}else{this.jsRunSequence.push({name:jslist[k].name,code:null,path:jslist[k].path,status:"comboloading"});requestingModules[jslist[k].name]=true;updateList+=(updateList==""?"":";")+jslist[k].path}}var that=this;if(!!updateList){var xhr=new XMLHttpRequest;xhr.open("get",combo+updateList,true);xhr.onreadystatechange=function(){if(xhr.readyState==4){if(xhr.status>=200&&xhr.status<300||xhr.status==304){if(xhr.response!=""){that.runCombo(xhr.response,requestingModules);return}}else{for(var i in that.jsRunSequence){if(requestingModules[that.jsRunSequence[i].name]){that.jsRunSequence[i].status="failed"}}that.runjs()}}};xhr.send(null)}this.runjs()};lsloader.runCombo=function(comboCode,requestingModules){comboCode=comboCode.split("/*combojs*/");comboCode.shift();for(var k in this.jsRunSequence){if(!!requestingModules[this.jsRunSequence[k].name]&&!!comboCode[0]){this.jsRunSequence[k].status="comboJS";this.jsRunSequence[k].code=comboCode[0];this.setLS(this.jsRunSequence[k].name,this.jsRunSequence[k].path+versionString+comboCode[0]);comboCode.shift()}}this.runjs()}})();</script>

    <!-- Import queue -->
    <script>function Queue(){this.dataStore=[];this.offer=b;this.poll=d;this.execNext=a;this.debug=false;this.startDebug=c;function b(e){if(this.debug){console.log("Offered a Queued Function.")}if(typeof e==="function"){this.dataStore.push(e)}else{console.log("You must offer a function.")}}function d(){if(this.debug){console.log("Polled a Queued Function.")}return this.dataStore.shift()}function a(){var e=this.poll();if(e!==undefined){if(this.debug){console.log("Run a Queued Function.")}e()}}function c(){this.debug=true}}var queue=new Queue();</script>

    <!-- Favicons -->
    <link rel="icon shortcut" type="image/ico" href="/img/favicon.png">
    <link rel="icon" sizes="192x192" href="/img/favicon.png">
    <link rel="apple-touch-icon" href="/img/favicon.png">

    <!--iOS -->
    <meta name="apple-mobile-web-app-title" content="Title">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="480">

    <!-- Add to homescreen for Chrome on Android -->
    <meta name="mobile-web-app-capable" content="yes">

    <!-- Add to homescreen for Safari on iOS -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-title" content="Jason">

    <!-- Site Verification -->
    
    

    <!-- RSS -->
    
        
            <link rel=alternate type="application/atom+xml" href="/atom.xml">
        
    

    <!--[if lte IE 9]>
        <link rel="stylesheet" href="/css/ie-blocker.css">

        
            <script src="/js/ie-blocker.en.js"></script>
        
    <![endif]-->

    <!-- Import CSS -->
    
        <style id="material_css"></style><script>if(typeof window.lsLoadCSSMaxNums === "undefined")window.lsLoadCSSMaxNums = 0;window.lsLoadCSSMaxNums++;lsloader.load("material_css","/css/material.min.css?Z7a72R1E4SxzBKR/WGctOA==",function(){if(typeof window.lsLoadCSSNums === "undefined")window.lsLoadCSSNums = 0;window.lsLoadCSSNums++;if(window.lsLoadCSSNums == window.lsLoadCSSMaxNums)document.documentElement.style.display="";}, false)</script>
        <style id="style_css"></style><script>if(typeof window.lsLoadCSSMaxNums === "undefined")window.lsLoadCSSMaxNums = 0;window.lsLoadCSSMaxNums++;lsloader.load("style_css","/css/style.min.css?MKetZV3cUTfDxvMffaOezg==",function(){if(typeof window.lsLoadCSSNums === "undefined")window.lsLoadCSSNums = 0;window.lsLoadCSSNums++;if(window.lsLoadCSSNums == window.lsLoadCSSMaxNums)document.documentElement.style.display="";}, false)</script>

        

    

    

    <!-- Config CSS -->

<!-- Other Styles -->
<style>
  body, html {
    font-family: Roboto, "Helvetica Neue", Helvetica, "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", "微软雅黑", Arial, sans-serif;
    overflow-x: hidden !important;
  }
  
  code {
    font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
  }

  a {
    color: #00838F;
  }

  .mdl-card__media,
  #search-label,
  #search-form-label:after,
  #scheme-Paradox .hot_tags-count,
  #scheme-Paradox .sidebar_archives-count,
  #scheme-Paradox .sidebar-colored .sidebar-header,
  #scheme-Paradox .sidebar-colored .sidebar-badge{
    background-color: #0097A7 !important;
  }

  /* Sidebar User Drop Down Menu Text Color */
  #scheme-Paradox .sidebar-colored .sidebar-nav>.dropdown>.dropdown-menu>li>a:hover,
  #scheme-Paradox .sidebar-colored .sidebar-nav>.dropdown>.dropdown-menu>li>a:focus {
    color: #0097A7 !important;
  }

  #post_entry-right-info,
  .sidebar-colored .sidebar-nav li:hover > a,
  .sidebar-colored .sidebar-nav li:hover > a i,
  .sidebar-colored .sidebar-nav li > a:hover,
  .sidebar-colored .sidebar-nav li > a:hover i,
  .sidebar-colored .sidebar-nav li > a:focus i,
  .sidebar-colored .sidebar-nav > .open > a,
  .sidebar-colored .sidebar-nav > .open > a:hover,
  .sidebar-colored .sidebar-nav > .open > a:focus,
  #ds-reset #ds-ctx .ds-ctx-entry .ds-ctx-head a {
    color: #0097A7 !important;
  }

  .toTop {
    background: #757575 !important;
  }

  .material-layout .material-post>.material-nav,
  .material-layout .material-index>.material-nav,
  .material-nav a {
    color: #757575;
  }

  #scheme-Paradox .MD-burger-layer {
    background-color: #757575;
  }

  #scheme-Paradox #post-toc-trigger-btn {
    color: #757575;
  }

  .post-toc a:hover {
    color: #00838F;
    text-decoration: underline;
  }

</style>


<!-- Theme Background Related-->

    <style>
      body{
        background-color: #F5F5F5;
      }

      /* blog_info bottom background */
      #scheme-Paradox .material-layout .something-else .mdl-card__supporting-text{
        background-color: #fff;
      }
    </style>




<!-- Fade Effect -->

    <style>
      .fade {
        transition: all 800ms linear;
        -webkit-transform: translate3d(0,0,0);
        -moz-transform: translate3d(0,0,0);
        -ms-transform: translate3d(0,0,0);
        -o-transform: translate3d(0,0,0);
        transform: translate3d(0,0,0);
        opacity: 1;
      }

      .fade.out{
        opacity: 0;
      }
    </style>


<!-- Import Font -->
<!-- Import Roboto -->

    <link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500" rel="stylesheet">


<!-- Import Material Icon -->

    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">




    <!-- Import jQuery -->
    
        <script>lsloader.load("jq_js","/js/jquery.min.js?ezyEvm8ST5CGfpA+kFFi1g==", true)</script>
    

    <!-- The Open Graph protocol -->
    <meta property="og:url" content="http://kidnet.github.io">
    <meta property="og:type" content="blog">
    <meta property="og:title" content="tcpdump实例 | Jason">
    <meta property="og:image" content="http://kidnet.github.io/img/favicon.png" />
    <meta property="og:description" content="">
    <meta property="og:article:tag" content="network"> 

    
        <meta property="article:published_time" content="Mon Jul 09 2018 10:15:49 GMT+0800" />
        <meta property="article:modified_time" content="Thu Jul 12 2018 15:56:40 GMT+0800" />
    

    <!-- The Twitter Card protocol -->
    <meta name="twitter:title" content="tcpdump实例 | Jason">
    <meta name="twitter:description" content="">
    <meta name="twitter:image" content="http://kidnet.github.io/img/favicon.png">
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:url" content="http://kidnet.github.io" />

    <!-- Add canonical link for SEO -->
    
        <link rel="canonical" href="http://kidnet.github.io/2018/07/09/tcpdump-examples/index.html" />
    

    <!-- Structured-data for SEO -->
    
        


<script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "BlogPosting",
    "mainEntityOfPage": "http://kidnet.github.io/2018/07/09/tcpdump-examples/index.html",
    "headline": "tcpdump实例",
    "datePublished": "Mon Jul 09 2018 10:15:49 GMT+0800",
    "dateModified": "Thu Jul 12 2018 15:56:40 GMT+0800",
    "author": {
        "@type": "Person",
        "name": "Jason",
        "image": {
            "@type": "ImageObject",
            "url": "/img/my_avatar.png"
        },
        "description": "Life is short, you need Python"
    },
    "publisher": {
        "@type": "Organization",
        "name": "Jason",
        "logo": {
            "@type":"ImageObject",
            "url": "/img/favicon.png"
        }
    },
    "keywords": ",network",
    "description": "",
}
</script>


    

    <!-- Analytics -->
    
        <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-106390087-1', 'auto');ga('send', 'pageview');
</script>
    
    
    

    <!-- Custom Head -->
    

</head>


    
        <body id="scheme-Paradox" class="lazy">
            <div class="material-layout  mdl-js-layout has-drawer is-upgraded">
                

                <!-- Main Container -->
                <main class="material-layout__content" id="main">

                    <!-- Top Anchor -->
                    <div id="top"></div>

                    
                        <!-- Hamburger Button -->
                        <button class="MD-burger-icon sidebar-toggle">
                            <span class="MD-burger-layer"></span>
                        </button>
                    

                    <!-- Post TOC -->

    
    <!-- Back Button -->
    <!--
    <div class="material-back" id="backhome-div" tabindex="0">
        <a class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon"
           href="#" onclick="window.history.back();return false;"
           target="_self"
           role="button"
           data-upgraded=",MaterialButton,MaterialRipple">
            <i class="material-icons" role="presentation">arrow_back</i>
            <span class="mdl-button__ripple-container">
                <span class="mdl-ripple"></span>
            </span>
        </a>
    </div>
    -->


    <!-- Left aligned menu below button -->
    
    
    <button id="post-toc-trigger-btn"
        class="mdl-button mdl-js-button mdl-button--icon">
        <i class="material-icons">format_list_numbered</i>
    </button>

    <ul class="post-toc-wrap mdl-menu mdl-menu--bottom-left mdl-js-menu mdl-js-ripple-effect" for="post-toc-trigger-btn" style="max-height:80vh; overflow-y:scroll;">
        <ol class="post-toc"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#基础"><span class="post-toc-number">1.</span> <span class="post-toc-text">基础</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#分解Tcpdump命令"><span class="post-toc-number">1.1.</span> <span class="post-toc-text">分解Tcpdump命令</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#显示ASCII字符的文本"><span class="post-toc-number">1.2.</span> <span class="post-toc-text">显示ASCII字符的文本</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#捕获指定协议"><span class="post-toc-number">1.3.</span> <span class="post-toc-text">捕获指定协议</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#基于IP地址来捕获指定的主机"><span class="post-toc-number">1.4.</span> <span class="post-toc-text">基于IP地址来捕获指定的主机</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#写入一个捕获文件"><span class="post-toc-number">1.5.</span> <span class="post-toc-text">写入一个捕获文件</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#行缓冲模式"><span class="post-toc-number">1.6.</span> <span class="post-toc-text">行缓冲模式</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#组合过滤器"><span class="post-toc-number">1.7.</span> <span class="post-toc-text">组合过滤器</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#实例"><span class="post-toc-number">2.</span> <span class="post-toc-text">实例</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#1-提取HTTP的User-Agent"><span class="post-toc-number">2.1.</span> <span class="post-toc-text">1. 提取HTTP的User-Agent</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#2-只捕获HTTP的GET和POST包"><span class="post-toc-number">2.2.</span> <span class="post-toc-text">2. 只捕获HTTP的GET和POST包</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#3-提取HTTP请求中的URL"><span class="post-toc-number">2.3.</span> <span class="post-toc-text">3. 提取HTTP请求中的URL</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#4-提取POST请求中的HTTP密码"><span class="post-toc-number">2.4.</span> <span class="post-toc-text">4. 提取POST请求中的HTTP密码</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#5-从服务器端和客户端捕获Cookies"><span class="post-toc-number">2.5.</span> <span class="post-toc-text">5. 从服务器端和客户端捕获Cookies</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#6-捕获所有ICMP数据包"><span class="post-toc-number">2.6.</span> <span class="post-toc-text">6. 捕获所有ICMP数据包</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#7-显示没有应答-返回的ICMP数据包-标准ping"><span class="post-toc-number">2.7.</span> <span class="post-toc-text">7. 显示没有应答/返回的ICMP数据包(标准ping)</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#8-捕获SMTP-POP3-Email"><span class="post-toc-number">2.8.</span> <span class="post-toc-text">8. 捕获SMTP/POP3 Email</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#9-诊断NTP的查询和响应"><span class="post-toc-number">2.9.</span> <span class="post-toc-text">9. 诊断NTP的查询和响应</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#10-捕获SNMP查询和响应"><span class="post-toc-number">2.10.</span> <span class="post-toc-text">10. 捕获SNMP查询和响应</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#11-捕获FTP凭据和命令"><span class="post-toc-number">2.11.</span> <span class="post-toc-text">11. 捕获FTP凭据和命令</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#12-轮转捕获文件"><span class="post-toc-number">2.12.</span> <span class="post-toc-text">12. 轮转捕获文件</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#13-捕获IPv6的流量"><span class="post-toc-number">2.13.</span> <span class="post-toc-text">13. 捕获IPv6的流量</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#14-在网络流量中探测端口扫描"><span class="post-toc-number">2.14.</span> <span class="post-toc-text">14. 在网络流量中探测端口扫描</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#15-展示Nmap-NSE脚本测试的实例"><span class="post-toc-number">2.15.</span> <span class="post-toc-text">15. 展示Nmap NSE脚本测试的实例</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#16-捕获每个非本地主机的开始和结尾的数据包"><span class="post-toc-number">2.16.</span> <span class="post-toc-text">16. 捕获每个非本地主机的开始和结尾的数据包</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#17-捕获DNS请求与响应"><span class="post-toc-number">2.17.</span> <span class="post-toc-text">17. 捕获DNS请求与响应</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#18-捕获HTTP数据包"><span class="post-toc-number">2.18.</span> <span class="post-toc-text">18. 捕获HTTP数据包</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#19-使用tcpdump进行捕获并在Wireshark中查看"><span class="post-toc-number">2.19.</span> <span class="post-toc-text">19. 使用tcpdump进行捕获并在Wireshark中查看</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#20-根据数据包量的主机排名"><span class="post-toc-number">2.20.</span> <span class="post-toc-text">20. 根据数据包量的主机排名</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#21-捕获所有明文密码"><span class="post-toc-number">2.21.</span> <span class="post-toc-text">21. 捕获所有明文密码</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#22-DHCP的例子"><span class="post-toc-number">2.22.</span> <span class="post-toc-text">22. DHCP的例子</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#总结"><span class="post-toc-number">3.</span> <span class="post-toc-text">总结</span></a></li></ol>
    </ul>
    




<!-- Layouts -->

    <!-- Post Module -->
    <div class="material-post_container">

        <div class="material-post mdl-grid">
            <div class="mdl-card mdl-shadow--4dp mdl-cell mdl-cell--12-col">

                <!-- Post Header(Thumbnail & Title) -->
                
    <!-- Paradox Post Header -->
    
        
            <!-- Random Thumbnail -->
            <div class="post_thumbnail-random mdl-card__media mdl-color-text--grey-50">
            <script type="text/ls-javascript" id="post-thumbnail-script">
    var randomNum = Math.floor(Math.random() * 19 + 1);

    $('.post_thumbnail-random').attr('data-original', '/img/random/material-' + randomNum + '.png');
    $('.post_thumbnail-random').addClass('lazy');
</script>

        
    
            <p class="article-headline-p">
                tcpdump实例
            </p>
        </div>





                
                    <!-- Paradox Post Info -->
                    <div class="mdl-color-text--grey-700 mdl-card__supporting-text meta">

    <!-- Author Avatar -->
    <div id="author-avatar">
        <img src="/img/my_avatar.png" width="44px" height="44px" alt="Author Avatar"/>
    </div>
    <!-- Author Name & Date -->
    <div>
        <strong>Jason</strong>
        <span>Jul 09, 2018</span>
    </div>

    <div class="section-spacer"></div>

    <!-- Favorite -->
    <!--
        <button id="article-functions-like-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon btn-like">
            <i class="material-icons" role="presentation">favorite</i>
            <span class="visuallyhidden">favorites</span>
        </button>
    -->

    <!-- Qrcode -->
    

    <!-- Tags (bookmark) -->
    
    <button id="article-functions-viewtags-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon">
        <i class="material-icons" role="presentation">bookmark</i>
        <span class="visuallyhidden">bookmark</span>
    </button>
    <ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="article-functions-viewtags-button">
        <li class="mdl-menu__item">
        <a class="post_tag-link" href="/tags/network/">network</a>
    </ul>
    

    <!-- Share -->
    <button id="article-fuctions-share-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon">
    <i class="material-icons" role="presentation">share</i>
    <span class="visuallyhidden">share</span>
</button>
<ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="article-fuctions-share-button">
    
    <!-- Leancloud Views -->
        <a class="post_share-link" href="#">
            <li class="mdl-menu__item">
                <span id="/2018/07/09/tcpdump-examples/" class="leancloud-views_num" data-flag-title="tcpdump实例">
     &nbsp;Views
</span>

            </li>
        </a>
    

    

    <!-- Share Weibo -->
    
        <a class="post_share-link" href="http://service.weibo.com/share/share.php?appkey=&title=tcpdump实例&url=http://kidnet.github.io/2018/07/09/tcpdump-examples/index.html&pic=http://kidnet.github.io/img/favicon.png&searchPic=false&style=simple" target="_blank">
            <li class="mdl-menu__item">
                Share to Weibo
            </li>
        </a>
    

    <!-- Share Twitter -->
    
        <a class="post_share-link" href="https://twitter.com/intent/tweet?text=tcpdump实例&url=http://kidnet.github.io/2018/07/09/tcpdump-examples/index.html&via=Jason" target="_blank">
            <li class="mdl-menu__item">
                Share to Twitter
            </li>
        </a>
    

    <!-- Share Facebook -->
    
        <a class="post_share-link" href="https://www.facebook.com/sharer/sharer.php?u=http://kidnet.github.io/2018/07/09/tcpdump-examples/index.html" target="_blank">
            <li class="mdl-menu__item">
                Share to Facebook
            </li>
        </a>
    

    <!-- Share Google+ -->
    
        <a class="post_share-link" href="https://plus.google.com/share?url=http://kidnet.github.io/2018/07/09/tcpdump-examples/index.html" target="_blank">
            <li class="mdl-menu__item">
                Share to Google+
            </li>
        </a>
    

    <!-- Share LinkedIn -->
    

    <!-- Share QQ -->
    

    <!-- Share Telegram -->
    
</ul>

</div>

                

                <!-- Post Content -->
                <div id="post-content" class="mdl-color-text--grey-700 mdl-card__supporting-text fade out">
    
        <blockquote>
<p>原文地址: <a href="https://hackertarget.com/tcpdump-examples/" target="_blank" rel="external">https://hackertarget.com/tcpdump-examples/</a></p>
</blockquote>
<p>实用的tcpdump实例可以解决你的网络故障和安全问题。 命令和示例并不仅仅是使用<code>tcpdump</code>，而且还是掌了解你的网络的方法。</p>
<p>了解<code>tcpdump</code>是一项必不可少的技能，可以为系统管理员，网络工程师或者专业的安全人员派上用场。</p>
<h2 id="基础"><a href="#基础" class="headerlink" title="基础"></a>基础</h2><h3 id="分解Tcpdump命令"><a href="#分解Tcpdump命令" class="headerlink" title="分解Tcpdump命令"></a>分解Tcpdump命令</h3><p>以下命令是使用<code>tcpdump</code>时经常能看到的参数。</p>
<pre><code>:~$ sudo tcpdump -i eth0 -nn -s0 -v port 80
</code></pre><p><font color="#348017">-i</font>: 选择在哪个端口上进行捕捉，这通常是一个网卡或者无线适配器，但也可以是一个<code>vlan</code>或某些更不常用的设备。 如果只有一个网络适配器的话，就不需要这参数了。  </p>
<p><font color="#FFA500">-nn</font>: 单独一个(n)不会解析主机名(直接显示IP)。 两个(n)将不会解析主机名或端口(直接显示IP或端口号)。 这个不仅更方便于查看IP/端口，还可以捕获大量的数据，并且可以大大提高捕获速度，因为名称解析会降低捕获速度。  </p>
<p><font color="#800000">-s0</font>: 捕获数据的长度，捕获数据包的大小。<code>-s0</code>将大小设置为无限制，如果要捕获所有流量，请使用此选项。 另外，如果你想从网络流量中获取二进制文件或文件，需要使用这个选项。  </p>
<p><font color="#DC143C">-v</font>: 详细信息，使用(-v)或者(-vv)增加输出的详细信息的信息量，经常是显示更多的协议的特定信息。  </p>
<p><font color="#0000A0">port 80</font>: 这通常是一个端口过滤器，只捕获80端口上的流量，这个端口当然通常是HTTP。</p>
<h3 id="显示ASCII字符的文本"><a href="#显示ASCII字符的文本" class="headerlink" title="显示ASCII字符的文本"></a>显示ASCII字符的文本</h3><p>在命令中加入<code>-A</code>参数，会从捕获的输会包含<code>ascii</code>字符。 这样可以很容易的读取并使用<code>grep</code>或其他命令来解析输出。 另外还有个选项<code>-X</code>也可以显示ASCII，并且可以显示十六进制输出。</p>
<pre><code>:~$ sudo tcpdump -A -s0 port 80
</code></pre><h3 id="捕获指定协议"><a href="#捕获指定协议" class="headerlink" title="捕获指定协议"></a>捕获指定协议</h3><p>过滤UDP的流量。 另一种方法是指定协议号<strong>protocol 17</strong>，这就是<code>udp</code>。 以下这两个命令的结果是相同的。 与<code>tcp</code>过滤器相同的是<strong>protocol 6</strong>。</p>
<pre><code>:~$ sudo tcpdump -i eth0 udp
:~$ sudo tcpdump -i eth0 proto 17
</code></pre><h3 id="基于IP地址来捕获指定的主机"><a href="#基于IP地址来捕获指定的主机" class="headerlink" title="基于IP地址来捕获指定的主机"></a>基于IP地址来捕获指定的主机</h3><p>使用<code>host</code>过滤器可以捕获到达(目的地)和来自(源)这个IP的流量。</p>
<pre><code>:~$ sudo tcpdump -i eth0 host 10.10.1.1
</code></pre><p>或者，使用<code>src</code>或<code>dst</code>来捕获一个方向的包。</p>
<pre><code>:~$ sudo tcpdump -i eth0 dst 10.10.1.20
</code></pre><h3 id="写入一个捕获文件"><a href="#写入一个捕获文件" class="headerlink" title="写入一个捕获文件"></a>写入一个捕获文件</h3><p>通过一个普通的命令选项就可以写一个标准的<code>pcap</code>文件。 写入的捕获文件可以在Wireshark或者其它的包分析工具中打开。</p>
<pre><code>:~$ sudo tcpdump -i eth0 -s0 -w test.pcap
</code></pre><h3 id="行缓冲模式"><a href="#行缓冲模式" class="headerlink" title="行缓冲模式"></a>行缓冲模式</h3><p>如果没有强制使用行缓冲模式(-l)或者数据包缓冲模式(-C)选项，在<code>tcpdump</code>输出时，通过管道传递给另一个命令(如grep)时，你不过实时获得预期的响应。 通过使用此选项，输出会立即通过管道发送给另一个命令，在排除故障时会立即响应。</p>
<pre><code>:~$ sudo tcpdump -i eth0 -s0 -l port 80 | grep &apos;Server:&apos;
</code></pre><h3 id="组合过滤器"><a href="#组合过滤器" class="headerlink" title="组合过滤器"></a>组合过滤器</h3><p>在上面这些示例中，你可以使用以下的标准逻辑来组合不同的过滤器。</p>
<pre><code>and or &amp;&amp;
or or ||
not or !
</code></pre><h2 id="实例"><a href="#实例" class="headerlink" title="实例"></a>实例</h2><p>在下面的例子中，很多都是可以用多种方法来实现相同的结果。 如在一些示例中所见，可以直接捕获包中的各个位。  </p>
<p>你使用什么方法将取决于你想要的什么样的输出及在线路上的流量。 如在一个流量频繁的千兆链接上，可能会强制你使用特定的低级别的数据包过滤器。  </p>
<p>当在排障时，你经常是想直接得到结果，这时需要在端口上进行过滤，并且选择<strong>ascii</strong>输出来结合<code>grep</code>, <code>cut</code>或者<code>awk</code>来获得最后结果。如果需要，你可以随时深入挖掘数据包。 </p>
<p>例如，当捕获HTTP请求和返回时，你可以通过移除<strong>SYN/ACK/FIN</strong>来过滤所有的除了数据之外的数据包，但无论怎样你如果使用<code>grep</code>都可以过滤掉噪音。(Keep it simple.)</p>
<p>可以在下面的例子中看到，其目的也是以最简单(也是最快）的方式来获得结果。  </p>
<h3 id="1-提取HTTP的User-Agent"><a href="#1-提取HTTP的User-Agent" class="headerlink" title="1. 提取HTTP的User-Agent"></a>1. 提取HTTP的User-Agent</h3><p>从HTTP请求头中提取User-Agent。</p>
<pre><code>:~$ sudo tcpdump -nn -A -s1500 -l | grep &quot;User-Agent:&quot;
</code></pre><p>通过使用<code>egrep</code>和多匹配项，我们可以获取User-Agent和Host(或者其它的字段)从请求中。</p>
<pre><code>:~$ sudo tcpdump -nn -A -s1500 -l | egrep -i &apos;User-Agent:|Host:&apos;
</code></pre><h3 id="2-只捕获HTTP的GET和POST包"><a href="#2-只捕获HTTP的GET和POST包" class="headerlink" title="2. 只捕获HTTP的GET和POST包"></a>2. 只捕获HTTP的GET和POST包</h3><p>深入的了解了过滤器后，发现我们只能指定匹配GET请求。</p>
<pre><code>:~$ sudo tcpdump -s 0 -A -vv &apos;tcp[((tcp[12:1] &amp; 0xf0) &gt;&gt; 2):4] = 0x47455420&apos;
</code></pre><p>或者我们只能选择匹配POST请求。 注意，这里可能POST的数据没有包含在这个过滤器捕获的数据包中，POST请求可能会被拆分跨多个TCP数据包。</p>
<pre><code>:~$ sudo tcpdump -s 0 -A -vv &apos;tcp[((tcp[12:1] &amp; 0xf0) &gt;&gt; 2):4] = 0x504f5354&apos;
</code></pre><p>上面表达式的中16进制匹配的是GET和POST的ascii码。</p>
<p><strong>tcp[((tcp[12:1] &amp; 0xf0) &gt;&gt; 2):4]</strong>中首先我们先确定我们需要的<a href="https://security.stackexchange.com/questions/121011/wireshark-tcp-filter-tcptcp121-0xf0-24" target="_blank" rel="external">字节位置</a>(在TCP标头之后的), 然后选择我们希望匹配的4个字节。</p>
<h3 id="3-提取HTTP请求中的URL"><a href="#3-提取HTTP请求中的URL" class="headerlink" title="3. 提取HTTP请求中的URL"></a>3. 提取HTTP请求中的URL</h3><p>从流量中简单的分析Host和HTTP请求的位置(URL)。 这里不指定80端口，我们可能在任何端口找到HTTP的请求，例如运行在高端口的HTTP服务。</p>
<pre><code>:~$ sudo tcpdump -s 0 -v -n -l | egrep -i &quot;POST /|GET /|Host:&quot;

tcpdump: listening on enp7s0, link-type EN10MB (Ethernet), capture size 262144 bytes
    POST /wp-login.php HTTP/1.1
    Host: dev.example.com
    GET /wp-login.php HTTP/1.1
    Host: dev.example.com
    GET /favicon.ico HTTP/1.1
    Host: dev.example.com
    GET / HTTP/1.1
    Host: dev.example.com
</code></pre><h3 id="4-提取POST请求中的HTTP密码"><a href="#4-提取POST请求中的HTTP密码" class="headerlink" title="4. 提取POST请求中的HTTP密码"></a>4. 提取POST请求中的HTTP密码</h3><p>从POST数据中获取密码。 这里提取信息包括”Host:”和请求的位置，以便知道密码的用途。</p>
<pre><code>:~$ sudo tcpdump -s 0 -A -n -l | egrep -i &quot;POST /|pwd=|passwd=|password=|Host:&quot;

tcpdump: verbose output suppressed, use -v or -vv for full protocol decode
listening on enp7s0, link-type EN10MB (Ethernet), capture size 262144 bytes
11:25:54.799014 IP 10.10.1.30.39224 &gt; 10.10.1.125.80: Flags [P.], seq 1458768667:1458770008, ack 2440130792, win 704, options [nop,nop,TS val 461552632 ecr 208900561], length 1341: HTTP: POST /wp-login.php HTTP/1.1
.....s..POST /wp-login.php HTTP/1.1
Host: dev.example.com
.....s..log=admin&amp;pwd=notmypassword&amp;wp-submit=Log+In&amp;redirect_to=http%3A%2F%2Fdev.example.com%2Fwp-admin%2F&amp;testcookie=1
</code></pre><h3 id="5-从服务器端和客户端捕获Cookies"><a href="#5-从服务器端和客户端捕获Cookies" class="headerlink" title="5. 从服务器端和客户端捕获Cookies"></a>5. 从服务器端和客户端捕获Cookies</h3><p>在服务器上通过检索”Set-Cookie:”(服务器端)和”Cookie:”(客户端)来捕获cookies。</p>
<pre><code>:~$ sudo tcpdump -nn -A -s0 -l | egrep -i &apos;Set-Cookie|Host:|Cookie:&apos;

tcpdump: verbose output suppressed, use -v or -vv for full protocol decode
listening on wlp58s0, link-type EN10MB (Ethernet), capture size 262144 bytes
Host: dev.example.com
Cookie: wordpress_86be02xxxxxxxxxxxxxxxxxxxc43=admin%7C152xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxfb3e15c744fdd6; _ga=GA1.2.21343434343421934; _gid=GA1.2.927343434349426; wordpress_test_cookie=WP+Cookie+check; wordpress_logged_in_86be654654645645645654645653fc43=admin%7C15275102testtesttesttestab7a61e; wp-settings-time-1=1527337439
</code></pre><h3 id="6-捕获所有ICMP数据包"><a href="#6-捕获所有ICMP数据包" class="headerlink" title="6. 捕获所有ICMP数据包"></a>6. 捕获所有ICMP数据包</h3><p>查看线路上所有的<code>ICMP</code>数据包。</p>
<pre><code>:~$ sudo tcpdump -n icmp

tcpdump: verbose output suppressed, use -v or -vv for full protocol decode
listening on enp7s0, link-type EN10MB (Ethernet), capture size 262144 bytes
11:34:21.590380 IP 10.10.1.217 &gt; 10.10.1.30: ICMP echo request, id 27948, seq 1, length 64
11:34:21.590434 IP 10.10.1.30 &gt; 10.10.1.217: ICMP echo reply, id 27948, seq 1, length 64
11:34:27.680307 IP 10.10.1.159 &gt; 10.10.1.1: ICMP 10.10.1.189 udp port 59619 unreachable, length 115
</code></pre><h3 id="7-显示没有应答-返回的ICMP数据包-标准ping"><a href="#7-显示没有应答-返回的ICMP数据包-标准ping" class="headerlink" title="7. 显示没有应答/返回的ICMP数据包(标准ping)"></a>7. 显示没有应答/返回的ICMP数据包(标准ping)</h3><p>通过过滤<code>icmp</code>类型来选择出非标准的<code>ping</code>数据包的<code>icmp</code>数据包。</p>
<pre><code>:~$ sudo tcpdump &apos;icmp[icmptype] != icmp-echo and icmp[icmptype] != icmp-echoreply&apos;

tcpdump: verbose output suppressed, use -v or -vv for full protocol decode
listening on enp7s0, link-type EN10MB (Ethernet), capture size 262144 bytes
11:37:04.041037 IP 10.10.1.189 &gt; 10.10.1.20: ICMP 10.10.1.189 udp port 36078 unreachable, length 156
</code></pre><h3 id="8-捕获SMTP-POP3-Email"><a href="#8-捕获SMTP-POP3-Email" class="headerlink" title="8. 捕获SMTP/POP3 Email"></a>8. 捕获SMTP/POP3 Email</h3><p>这样能提取出email邮件体和其他的数据， 在这个例子中我们仅解析出邮件的收件人。</p>
<pre><code>:~$ sudo tcpdump -nn -l port 25 | grep -i &apos;MAIL FROM\|RCPT TO&apos;
</code></pre><h3 id="9-诊断NTP的查询和响应"><a href="#9-诊断NTP的查询和响应" class="headerlink" title="9. 诊断NTP的查询和响应"></a>9. 诊断NTP的查询和响应</h3><p>在这个例子中可以看到NTP的查询和响应。</p>
<pre><code>:~$ sudo tcpdump dst port 123

tcpdump: verbose output suppressed, use -v or -vv for full protocol decode
listening on eth0, link-type EN10MB (Ethernet), capture size 65535 bytes
21:02:19.112502 IP test33.ntp &gt; 199.30.140.74.ntp: NTPv4, Client, length 48
21:02:19.113888 IP 216.239.35.0.ntp &gt; test33.ntp: NTPv4, Server, length 48
21:02:20.150347 IP test33.ntp &gt; 216.239.35.0.ntp: NTPv4, Client, length 48
21:02:20.150991 IP 216.239.35.0.ntp &gt; test33.ntp: NTPv4, Server, length 48
</code></pre><h3 id="10-捕获SNMP查询和响应"><a href="#10-捕获SNMP查询和响应" class="headerlink" title="10. 捕获SNMP查询和响应"></a>10. 捕获SNMP查询和响应</h3><p>用<code>onsixtyone</code>快速SNMP协议扫描器来测试一个本地网络的SNMP服务，并且捕获<code>GetRequest</code>和<code>GetResponse</code>。 对于那些有过诊断SNMP故障愉快或不愉快经历的人，这都是一个很好的方法去查看线路上到底发生了什么状况。</p>
<pre><code>:~$ onesixtyone 10.10.1.10 public

Scanning 1 hosts, 1 communities
10.10.1.10 [public] Linux test33 4.15.0-20-generic #21-Ubuntu SMP Tue Apr 24 06:16:15 UTC 2018 x86_64
</code></pre><!-- -->  
<pre><code>:~$ sudo tcpdump -n -s0  port 161 and udp
tcpdump: verbose output suppressed, use -v or -vv for full protocol decode
listening on wlp58s0, link-type EN10MB (Ethernet), capture size 262144 bytes
23:39:13.725522 IP 10.10.1.159.36826 &gt; 10.10.1.20.161:  GetRequest(28)  .1.3.6.1.2.1.1.1.0
23:39:13.728789 IP 10.10.1.20.161 &gt; 10.10.1.159.36826:  GetResponse(109)  .1.3.6.1.2.1.1.1.0=&quot;Linux testmachine 4.15.0-20-generic #21-Ubuntu SMP Tue Apr 24 06:16:15 UTC 2018 x86_64&quot;
</code></pre><h3 id="11-捕获FTP凭据和命令"><a href="#11-捕获FTP凭据和命令" class="headerlink" title="11. 捕获FTP凭据和命令"></a>11. 捕获FTP凭据和命令</h3><p>可以直接捕获FTP命令和登录细节。 身份验证之后，FTP的会话可能是<strong>主动(active)</strong>或<strong>被动(passive)</strong>模式，使用的模式将确定会话的数据部分是通过TCP 20端口还是另一个随机端口传输的。 使用以下命令你可以捕获输出中的USER和PASS(可以输出给grep)，以及LIST, CWD和PASSIVE等FTP命令。</p>
<pre><code>:~$ sudo tcpdump -nn -v port ftp or ftp-data
</code></pre><h3 id="12-轮转捕获文件"><a href="#12-轮转捕获文件" class="headerlink" title="12. 轮转捕获文件"></a>12. 轮转捕获文件</h3><p>当捕获大量的流量或者长时间的进行捕获时，采用自动轮转会很有帮助，它会按照固定大小来创建新文件。 使用参数<code>-W</code>, <code>-G</code>和<code>-C</code>来完成自动轮转。</p>
<p>在下面这个命令中，会每(-G)<strong>3600秒</strong>(1小时)创建文件<strong>capture-(hour).pcap</strong>。 在第二天这些文件将会被重写，最终这个文件应该是<strong>capture-{1-24}.pcap, 如15点，那么新文件就是</strong>/tmp/capture-15.pcap__。</p>
<pre><code>:~$ tcpdump  -w /tmp/capture-%H.pcap -G 3600 -C 200
</code></pre><h3 id="13-捕获IPv6的流量"><a href="#13-捕获IPv6的流量" class="headerlink" title="13. 捕获IPv6的流量"></a>13. 捕获IPv6的流量</h3><p>使用<code>ip6</code>过滤器可以捕获IPv6的流量。 在下面的例子中我们使用<code>proto 6</code>和<code>proto 17</code>指定了TCP和UDP协议。</p>
<pre><code>tcpdump -nn ip6 proto 6
</code></pre><p>可以从之前保存的捕获文件中读取IPv6的UDP协议。</p>
<pre><code>tcpdump -nr ipv6-test.pcap ip6 proto 17
</code></pre><h3 id="14-在网络流量中探测端口扫描"><a href="#14-在网络流量中探测端口扫描" class="headerlink" title="14. 在网络流量中探测端口扫描"></a>14. 在网络流量中探测端口扫描</h3><p>下面这个例子中可以看到这些流量来自一个源到一个目的的。 可以看到标志[S]和[R]与看似随机的一系列目标端口进行匹配。 当SYN在目标系统上发现一个关闭的端口，这些端口会在RESET上被看到。 这是一个典型的被像<a href="https://hackertarget.com/nmap-tutorial/" target="_blank" rel="external">Nmap</a>样的工具进行扫面的行为。  </p>
<p>这里有另一个<a href="https://hackertarget.com/nmap-tutorial/" target="_blank" rel="external">Nmap的教程</a>, 详细介绍了Wireshark中捕获的端口扫面(<strong>open/close/filtered</strong>)。</p>
<pre><code>:~$ tcpdump -nn

21:46:19.693601 IP 10.10.1.10.60460 &gt; 10.10.1.199.5432: Flags [S], seq 116466344, win 29200, options [mss 1460,sackOK,TS val 3547090332 ecr 0,nop,wscale 7], length 0
21:46:19.693626 IP 10.10.1.10.35470 &gt; 10.10.1.199.513: Flags [S], seq 3400074709, win 29200, options [mss 1460,sackOK,TS val 3547090332 ecr 0,nop,wscale 7], length 0
21:46:19.693762 IP 10.10.1.10.44244 &gt; 10.10.1.199.389: Flags [S], seq 2214070267, win 29200, options [mss 1460,sackOK,TS val 3547090333 ecr 0,nop,wscale 7], length 0
21:46:19.693772 IP 10.10.1.199.389 &gt; 10.10.1.10.44244: Flags [R.], seq 0, ack 2214070268, win 0, length 0
21:46:19.693783 IP 10.10.1.10.35172 &gt; 10.10.1.199.1433: Flags [S], seq 2358257571, win 29200, options [mss 1460,sackOK,TS val 3547090333 ecr 0,nop,wscale 7], length 0
21:46:19.693826 IP 10.10.1.10.33022 &gt; 10.10.1.199.49153: Flags [S], seq 2406028551, win 29200, options [mss 1460,sackOK,TS val 3547090333 ecr 0,nop,wscale 7], length 0
21:46:19.695567 IP 10.10.1.10.55130 &gt; 10.10.1.199.49154: Flags [S], seq 3230403372, win 29200, options [mss  1460,sackOK,TS val 3547090334 ecr 0,nop,wscale 7], length 0
21:46:19.695590 IP 10.10.1.199.49154 &gt; 10.10.1.10.55130: Flags [R.], seq 0, ack 3230403373, win 0, length 0
21:46:19.695608 IP 10.10.1.10.33460 &gt; 10.10.1.199.49152: Flags [S], seq 3289070068, win 29200, options [mss 1460,sackOK,TS val 3547090335 ecr 0,nop,wscale 7], length 0
21:46:19.695622 IP 10.10.1.199.49152 &gt; 10.10.1.10.33460: Flags [R.], seq 0, ack 3289070069, win 0, length 0
21:46:19.695637 IP 10.10.1.10.34940 &gt; 10.10.1.199.1029: Flags [S], seq 140319147, win 29200, options [mss 1460,sackOK,TS val 3547090335 ecr 0,nop,wscale 7], length 0
21:46:19.695650 IP 10.10.1.199.1029 &gt; 10.10.1.10.34940: Flags [R.], seq 0, ack 140319148, win 0, length 0
21:46:19.695664 IP 10.10.1.10.45648 &gt; 10.10.1.199.5060: Flags [S], seq 2203629201, win 29200, options [mss 1460,sackOK,TS val 3547090335 ecr 0,nop,wscale 7], length 0
21:46:19.695775 IP 10.10.1.10.49028 &gt; 10.10.1.199.2000: Flags [S], seq 635990431, win 29200, options [mss 1460,sackOK,TS val 3547090335 ecr 0,nop,wscale 7], length 0
21:46:19.695790 IP 10.10.1.199.2000 &gt; 10.10.1.10.49028: Flags [R.], seq 0, ack 635990432, win 0, length 0
</code></pre><h3 id="15-展示Nmap-NSE脚本测试的实例"><a href="#15-展示Nmap-NSE脚本测试的实例" class="headerlink" title="15. 展示Nmap NSE脚本测试的实例"></a>15. 展示Nmap NSE脚本测试的实例</h3><p>在这个示例中，展示了Nmap NSE脚本<code>http-enum.nse</code>针对访问HTTP服务有效的URL的测试。</p>
<p>在Nmap的服务器上:</p>
<pre><code>:~$ nmap -p 80 --script=http-enum.nse targetip
</code></pre><p>在目标服务器上:</p>
<pre><code>:~$ tcpdump -nn port 80 | grep &quot;GET /&quot;

GET /w3perl/ HTTP/1.1
GET /w-agora/ HTTP/1.1
GET /way-board/ HTTP/1.1
GET /web800fo/ HTTP/1.1
GET /webaccess/ HTTP/1.1
GET /webadmin/ HTTP/1.1
GET /webAdmin/ HTTP/1.1
</code></pre><h3 id="16-捕获每个非本地主机的开始和结尾的数据包"><a href="#16-捕获每个非本地主机的开始和结尾的数据包" class="headerlink" title="16. 捕获每个非本地主机的开始和结尾的数据包"></a>16. 捕获每个非本地主机的开始和结尾的数据包</h3><p>这个例子是出自<code>tcpdump</code>的man page。 通过筛选<code>tcp-syn</code>和<code>tcp-fin</code>数据包，可以显示每个已经连接的TCP会话，其中包含时间戳，但没有数据。 与许多过滤器一样，这样可以减少噪音，从而更专注于你关心的信息。</p>
<pre><code>:~$ tcpdump &apos;tcp[tcpflags] &amp; (tcp-syn|tcp-fin) != 0 and not src and dst net localnet&apos;
</code></pre><h3 id="17-捕获DNS请求与响应"><a href="#17-捕获DNS请求与响应" class="headerlink" title="17. 捕获DNS请求与响应"></a>17. 捕获DNS请求与响应</h3><p>在这个捕获中可以看到对外访问Google公共DNS的请求和A记录(ip地址)的响应。</p>
<pre><code>:~$ sudo tcpdump -i wlp58s0 -s0 port 53

tcpdump: verbose output suppressed, use -v or -vv for full protocol decode
listening on wlp58s0, link-type EN10MB (Ethernet), capture size 262144 bytes
14:19:06.879799 IP test.53852 &gt; google-public-dns-a.google.com.domain: 26977+ [1au] A? play.google.com. (44)
14:19:07.022618 IP google-public-dns-a.google.com.domain &gt; test.53852: 26977 1/0/1 A 216.58.203.110 (60)
</code></pre><h3 id="18-捕获HTTP数据包"><a href="#18-捕获HTTP数据包" class="headerlink" title="18. 捕获HTTP数据包"></a>18. 捕获HTTP数据包</h3><p>在80端口仅捕获HTTP的数据包。 避免捕获TCP的连接(SYN/FIN/ACK)。</p>
<pre><code>tcpdump &apos;tcp port 80 and (((ip[2:2] - ((ip[0]&amp;0xf)&lt;&lt;2)) - ((tcp[12]&amp;0xf0)&gt;&gt;2)) != 0)&apos;
</code></pre><h3 id="19-使用tcpdump进行捕获并在Wireshark中查看"><a href="#19-使用tcpdump进行捕获并在Wireshark中查看" class="headerlink" title="19. 使用tcpdump进行捕获并在Wireshark中查看"></a>19. 使用tcpdump进行捕获并在Wireshark中查看</h3><p>使用Wireshark(或tshark)解析与分析完整的应用程序流(如HTTP)比用<code>tcpdump</code>更容易。 通常更实用的事使用<code>tcpdump</code>捕获结果写入文件的选项来捕获远程系统上的流量。 然后拷贝这个<code>pcap</code>文件到本地的工作机，使用Wireshark来分析。 </p>
<p>除了手动将文件从远程系统移动到本地工作机之外，还可以通过SSH来实时捕获远程系统的流量信息提供给Wireshark。 <strong>别忘了</strong>使用<code>not port 22</code>来过滤掉SSH的流量。</p>
<pre><code>:~$ ssh root@remotesystem &apos;tcpdump -s0 -c 1000 -nn -w - not port 22&apos; | wireshark -k -i -
</code></pre><p>另一个提示，在远程使用<code>tcpdump</code>时使用计数选项<code>-c</code>来允许捕获完成，否则当<code>ctrl-c</code>时不仅会kiil掉<code>tcpdump</code>，还会kill掉Wireshark和正在进行捕获。</p>
<h3 id="20-根据数据包量的主机排名"><a href="#20-根据数据包量的主机排名" class="headerlink" title="20. 根据数据包量的主机排名"></a>20. 根据数据包量的主机排名</h3><p>列出在一段时间根据数据包量来排名连接的主机。 使用简单的命令行通过字段提取来获取IP地址，对事件进行排序和计数。 别忘记限制捕获数量的选项<code>-c</code>。</p>
<pre><code>sudo tcpdump -nnn -t -c 200 | cut -f 1,2,3,4 -d &apos;.&apos; | sort | uniq -c | sort -nr | head -n 20

tcpdump: verbose output suppressed, use -v or -vv for full protocol decode
listening on enp7s0, link-type EN10MB (Ethernet), capture size 262144 bytes
200 packets captured
261 packets received by filter
0 packets dropped by kernel
    108 IP 10.10.211.181
     91 IP 10.10.1.30
      1 IP 10.10.1.50
</code></pre><h3 id="21-捕获所有明文密码"><a href="#21-捕获所有明文密码" class="headerlink" title="21. 捕获所有明文密码"></a>21. 捕获所有明文密码</h3><p>在这个命令中，我们专注于纯文本的协议，并使用<code>grep</code>来找出和用户或密码相关的信息。 通过<code>grep</code>的<code>-B5</code>选项来获得前5行输出，这些行是提供了捕获的密码(主机名, IP地址, 系统)的上下文。</p>
<pre><code>:~$ sudo tcpdump port http or port ftp or port smtp or port imap or port pop3 or port telnet -l -A | egrep -i -B5 &apos;pass=|pwd=|log=|login=|user=|username=|pw=|passw=|passwd=|password=|pass:|user:|username:|password:|login:|pass |user &apos;
</code></pre><h3 id="22-DHCP的例子"><a href="#22-DHCP的例子" class="headerlink" title="22. DHCP的例子"></a>22. DHCP的例子</h3><p>最后一个<code>tcpdump</code>的例子是监控DHCP请求和应答的。 DHCP请求是在<strong>端口67</strong>上，应答是在<strong>端口68</strong>上。 使用<code>-v</code>选项可以看到协议的选项和其它的细节。</p>
<p>:~$ sudo tcpdump -v -n port 67 or 68</p>
<pre><code>tcpdump: listening on enp7s0, link-type EN10MB (Ethernet), capture size 262144 bytes
14:37:50.059662 IP (tos 0x10, ttl 128, id 0, offset 0, flags [none], proto UDP (17), length 328)
    0.0.0.0.68 &gt; 255.255.255.255.67: BOOTP/DHCP, Request from 00:0c:xx:xx:xx:d5, length 300, xid 0xc9779c2a, Flags [none]
      Client-Ethernet-Address 00:0c:xx:xx:xx:d5
      Vendor-rfc1048 Extensions
        Magic Cookie 0x63825363
        DHCP-Message Option 53, length 1: Request
        Requested-IP Option 50, length 4: 10.10.1.163
        Hostname Option 12, length 14: &quot;test-ubuntu&quot;
        Parameter-Request Option 55, length 16: 
          Subnet-Mask, BR, Time-Zone, Default-Gateway
          Domain-Name, Domain-Name-Server, Option 119, Hostname
          Netbios-Name-Server, Netbios-Scope, MTU, Classless-Static-Route
          NTP, Classless-Static-Route-Microsoft, Static-Route, Option 252
14:37:50.059667 IP (tos 0x10, ttl 128, id 0, offset 0, flags [none], proto UDP (17), length 328)
    0.0.0.0.68 &gt; 255.255.255.255.67: BOOTP/DHCP, Request from 00:0c:xx:xx:xx:d5, length 300, xid 0xc9779c2a, Flags [none]
      Client-Ethernet-Address 00:0c:xx:xx:xx:d5
      Vendor-rfc1048 Extensions
        Magic Cookie 0x63825363
        DHCP-Message Option 53, length 1: Request
        Requested-IP Option 50, length 4: 10.10.1.163
        Hostname Option 12, length 14: &quot;test-ubuntu&quot;
        Parameter-Request Option 55, length 16: 
          Subnet-Mask, BR, Time-Zone, Default-Gateway
          Domain-Name, Domain-Name-Server, Option 119, Hostname
          Netbios-Name-Server, Netbios-Scope, MTU, Classless-Static-Route
          NTP, Classless-Static-Route-Microsoft, Static-Route, Option 252
14:37:50.060780 IP (tos 0x0, ttl 64, id 53564, offset 0, flags [none], proto UDP (17), length 339)
    10.10.1.1.67 &gt; 10.10.1.163.68: BOOTP/DHCP, Reply, length 311, xid 0xc9779c2a, Flags [none]
      Your-IP 10.10.1.163
      Server-IP 10.10.1.1
      Client-Ethernet-Address 00:0c:xx:xx:xx:d5
      Vendor-rfc1048 Extensions
        Magic Cookie 0x63825363
        DHCP-Message Option 53, length 1: ACK
        Server-ID Option 54, length 4: 10.10.1.1
        Lease-Time Option 51, length 4: 86400
        RN Option 58, length 4: 43200
        RB Option 59, length 4: 75600
        Subnet-Mask Option 1, length 4: 255.255.255.0
        BR Option 28, length 4: 10.10.1.255
        Domain-Name-Server Option 6, length 4: 10.10.1.1
        Hostname Option 12, length 14: &quot;test-ubuntu&quot;
        T252 Option 252, length 1: 10
        Default-Gateway Option 3, length 4: 10.10.1.1
</code></pre><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>这些<code>tcpdump</code>的例子，提示和命令是让你对<code>tcpdump</code>可以有的用途做个基本了解。 根据你要实现的目标，有许多更深入的方法或组合不同的捕获过滤器来满足你的实际需求。  </p>
<p>将<code>tcpdump</code>和Wireshark结合使用会得到很强的功能，特别是你希望深入了解完整的应用层会话时，因为解释器可以组合完整的流。 </p>

        
    

    
</div>


                

                <!-- Post Comments -->
                
                    
                
            </div>

            <!-- Post Prev & Next Nav -->
            <nav class="material-nav mdl-color-text--grey-50 mdl-cell mdl-cell--12-col">
    <!-- Prev Nav -->
    
        <a href="/2018/07/16/ctop/" id="post_nav-newer" class="prev-content">
            <button class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon mdl-color--white mdl-color-text--grey-900" role="presentation">
                <i class="material-icons">arrow_back</i>
            </button>
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            Newer
        </a>
    

    <!-- Section Spacer -->
    <div class="section-spacer"></div>

    <!-- Next Nav -->
    
        <a href="/2018/07/03/10_useful_commands_to_collect_system_and_hardware_information/" id="post_nav-older" class="next-content">
            Older
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            <button class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon mdl-color--white mdl-color-text--grey-900" role="presentation">
                <i class="material-icons">arrow_forward</i>
            </button>
        </a>
    
</nav>

        </div>
    </div>



                    
                        <!-- Overlay For Active Sidebar -->
<div class="sidebar-overlay"></div>

<!-- Material sidebar -->
<aside id="sidebar" class="sidebar sidebar-colored sidebar-fixed-left" role="navigation">
    <div id="sidebar-main">
        <!-- Sidebar Header -->
        <div class="sidebar-header header-cover" style="background-image: url(/img/sidebar_header.png);">
    <!-- Top bar -->
    <div class="top-bar"></div>

    <!-- Sidebar toggle button -->
    <button type="button" class="sidebar-toggle mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon" style="display: initial;" data-upgraded=",MaterialButton,MaterialRipple">
        <i class="material-icons">clear_all</i>
        <span class="mdl-button__ripple-container">
            <span class="mdl-ripple">
            </span>
        </span>
    </button>

    <!-- Sidebar Avatar -->
    <div class="sidebar-image">
        <img src="/img/my_avatar.png" alt="Jason's avatar">
    </div>

    <!-- Sidebar Email -->
    <a data-toggle="dropdown" class="sidebar-brand" href="#settings-dropdown">
        kidnet05@gmail.com
        <b class="caret"></b>
    </a>
</div>


        <!-- Sidebar Navigation  -->
        <ul class="nav sidebar-nav">
    <!-- User dropdown  -->
    <li class="dropdown">
        <ul id="settings-dropdown" class="dropdown-menu">
            
                <li>
                    <a href="#" target="_blank" title="Email Me">
                        
                            <i class="material-icons sidebar-material-icons sidebar-indent-left1pc-element">email</i>
                        
                        Email Me
                    </a>
                </li>
            
        </ul>
    </li>

    <!-- Homepage -->
    
        <li id="sidebar-first-li">
            <a href="/">
                
                    <i class="material-icons sidebar-material-icons">home</i>
                
                Home
            </a>
        </li>
        
    

    <!-- Archives  -->
    
        <li class="dropdown">
            <a href="#" class="ripple-effect dropdown-toggle" data-toggle="dropdown">
                
                    <i class="material-icons sidebar-material-icons">inbox</i>
                
                    Archives
                <b class="caret"></b>
            </a>
            <ul class="dropdown-menu">
            <li>
                <a class="sidebar_archives-link" href="/archives/2018/07/">July 2018<span class="sidebar_archives-count">6</span></a></li><li><a class="sidebar_archives-link" href="/archives/2018/06/">June 2018<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2018/03/">March 2018<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/12/">December 2017<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/11/">November 2017<span class="sidebar_archives-count">4</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/10/">October 2017<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/09/">September 2017<span class="sidebar_archives-count">3</span></a>
            </ul>
        </li>
        
    

    <!-- Categories  -->
    
        <li class="dropdown">
            <a href="#" class="ripple-effect dropdown-toggle" data-toggle="dropdown">
                
                    <i class="material-icons sidebar-material-icons">chrome_reader_mode</i>
                
                Categories
                <b class="caret"></b>
            </a>
            <ul class="dropdown-menu">
                <li>
                <a class="sidebar_archives-link" href="/categories/Python/">Python<span class="sidebar_archives-count">1</span></a>
            </ul>
        </li>
        
    

    <!-- Pages  -->
    

    <!-- Article Number  -->
    
</ul>


        <!-- Sidebar Footer -->
        <!--
I'm glad you use this theme, the development is no so easy, I hope you can keep the copyright, I will thank you so much.
If you still want to delete the copyrights, could you still retain the first one? Which namely "Theme Material"
It will not impact the appearance and can give developers a lot of support :)

很高兴您使用并喜欢该主题，开发不易 十分谢谢与希望您可以保留一下版权声明。
如果您仍然想删除的话 能否只保留第一项呢？即 "Theme Material"
它不会影响美观并可以给开发者很大的支持和动力。 :)
-->

<!-- Sidebar Divider -->

    <div class="sidebar-divider"></div>


<!-- Theme Material -->

    <a href="https://github.com/viosey/hexo-theme-material"  class="sidebar-footer-text-a" target="_blank">
        <div class="sidebar-text mdl-button mdl-js-button mdl-js-ripple-effect sidebar-footer-text-div" data-upgraded=",MaterialButton,MaterialRipple">
            Theme - Material
            <span class="sidebar-badge badge-circle">i</span>
        </div>
    </a>


<!-- Help & Support -->
<!--

-->

<!-- Feedback -->
<!--

-->

<!-- About Theme -->
<!--

-->

    </div>

    <!-- Sidebar Image -->
    

</aside>

                    

                    
                        <!-- Footer Top Button -->
                        <div id="back-to-top" class="toTop-wrap">
    <a href="#top" class="toTop">
        <i class="material-icons footer_top-i">expand_less</i>
    </a>
</div>

                    

                    <!--Footer-->
<footer class="mdl-mini-footer" id="bottom">
    
        <!-- Paradox Footer Left Section -->
        <div class="mdl-mini-footer--left-section sns-list">
    <!-- Twitter -->
    
        <a href="https://twitter.com/kid_net" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn footer-sns-twitter">
                <span class="visuallyhidden">Twitter</span>
            </button><!--
     --></a>
    

    <!-- Facebook -->
    
        <a href="https://www.facebook.com/jason.gao1" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn footer-sns-facebook">
                <span class="visuallyhidden">Facebook</span>
            </button><!--
     --></a>
    

    <!-- Google + -->
    
        <a href="https://www.google.com/" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn footer-sns-gplus">
                <span class="visuallyhidden">Google Plus</span>
            </button><!--
     --></a>
    

    <!-- Weibo -->
    

    <!-- Instagram -->
    

    <!-- Tumblr -->
    

    <!-- Github -->
    
        <a href="https://github.com/kidnet" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn footer-sns-github">
                <span class="visuallyhidden">Github</span>
            </button><!--
     --></a>
    

    <!-- LinkedIn -->
    

    <!-- Zhihu -->
    

    <!-- Bilibili -->
    

    <!-- Telegram -->
    
    
    <!-- V2EX -->
    
</div>


        <!--Copyright-->
        <div id="copyright">
            Copyright&nbsp;©<script type="text/javascript">var fd = new Date();document.write("&nbsp;" + fd.getFullYear() + "&nbsp;");</script>Jason
            
        </div>

        <!-- Paradox Footer Right Section -->

        <!--
        I am glad you use this theme, the development is no so easy, I hope you can keep the copyright.
        It will not impact the appearance and can give developers a lot of support :)

        很高兴您使用该主题，开发不易，希望您可以保留一下版权声明。
        它不会影响美观并可以给开发者很大的支持。 :)
        -->

        <div class="mdl-mini-footer--right-section">
            <div>
                <div class="footer-develop-div">Powered by <a href="https://hexo.io" target="_blank" class="footer-develop-a">Hexo</a></div>
                <div class="footer-develop-div">Theme - <a href="https://github.com/viosey/hexo-theme-material" target="_blank" class="footer-develop-a">Material</a></div>
            </div>
        </div>
    
</footer>


                    <!-- Import JS File -->

    <script>lsloader.load("lazyload_js","/js/lazyload.min.js?wgjW/HuQG9JDgvPDPoRAng==", true)</script>



    <script>lsloader.load("js_js","/js/js.min.js?V/53wGualMuiPM3xoetD5Q==", true)</script>



    <script>lsloader.load("np_js","/js/nprogress.js?pl3Qhb9lvqR1FlyLUna1Yw==", true)</script>


<script type="text/ls-javascript" id="NProgress-script">
    NProgress.configure({
        showSpinner: true
    });
    NProgress.start();
    $('#nprogress .bar').css({
        'background': '#29d'
    });
    $('#nprogress .peg').css({
        'box-shadow': '0 0 10px #29d, 0 0 15px #29d'
    });
    $('#nprogress .spinner-icon').css({
        'border-top-color': '#29d',
        'border-left-color': '#29d'
    });
    setTimeout(function() {
        NProgress.done();
        $('.fade').removeClass('out');
    }, 800);
</script>





    <!-- Leancloud -->
    <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.1.js"></script>
    <script>
        AV.initialize('y30tHfICI3G905OwUnvNnxUG-gzGzoHsz', 'MkAA3GVAD8YE74bBpECF3XnC');
    </script>
    <script type="text/ls-javascript" id="leancloud-views-script">
    function showTime(Counter) {
        var query = new AV.Query(Counter);
        $('.leancloud-views_num').each(function() {
            var url = $(this).attr('id').trim();
            query.equalTo('url', url);
            query.find({
                success: function(results) {
                    if (results.length === 0) {
                        var content = '0 ' + $(document.getElementById(url)).text();
                        $(document.getElementById(url)).text(content);
                        return;
                    }
                    for (var i = 0; i < results.length; i++) {
                        var object = results[i];
                        var content = object.get('time') + ' ' + $(document.getElementById(url)).text();
                        $(document.getElementById(url)).text(content);
                    }
                },
                error: function(object, error) {
                    console.log('Error: ' + error.code + ' ' + error.message);
                }
            });
        });
    }

    function addCount(Counter) {
      var Counter = AV.Object.extend('Counter');
      url = $('.leancloud-views_num').attr('id').trim();
      title = $('.leancloud-views_num').attr('data-flag-title').trim();
      var query = new AV.Query(Counter);
      query.equalTo('url', url);
      query.find({
          success: function(results) {
            if (results.length > 0) {
                var counter = results[0];
                counter.fetchWhenSave(true);
                counter.increment('time');
                counter.save(null, {
                    success: function(counter) {
                        var content =  counter.get('time') + ' ' + $(document.getElementById(url)).text();
                        $(document.getElementById(url)).text(content);
                    },
                    error: function(counter, error) {
                        console.log('Failed to save Visitor num, with error message: ' + error.message);
                    }
                });
            } else {
              var newcounter = new Counter();
              newcounter.set('title', title);
              newcounter.set('url', url);
              newcounter.set('time', 1);
              newcounter.save(null, {
                  success: function(newcounter) {
                      console.log('newcounter.get(\'time\')='+newcounter.get('time'));
                      var content = newcounter.get('time') + ' ' + $(document.getElementById(url)).text();
                      $(document.getElementById(url)).text(content);
                  },
                  error: function(newcounter, error) {
                      console.log('Failed to create');
                  }
              });
            }
        },
        error: function(error) {
            console.log('Error:' + error.code + ' ' + error.message);
        }
      });
    }
    $(function() {
        var Counter = AV.Object.extend('Counter');
        if ($('.leancloud-views_num').length === 1) {
            addCount(Counter);
        } else if ($('.post-title-link').length > 1) {
            showTime(Counter);
        }
    });
</script>










<!-- UC Browser Compatible -->
<script>
	var agent = navigator.userAgent.toLowerCase();
	if(agent.indexOf('ucbrowser')>0) {
		document.write('<link rel="stylesheet" href="/css/uc.css">');
	   alert('由于 UC 浏览器使用极旧的内核，而本网站使用了一些新的特性。\n为了您能更好的浏览，推荐使用 Chrome 或 Firefox 浏览器。');
	}
</script>

<!-- Import prettify js  -->



<!-- Window Load -->
<!-- add class for prettify -->
<script type="text/ls-javascript" id="window-load">
    $(window).on('load', function() {
        // Post_Toc parent position fixed
        $('.post-toc-wrap').parent('.mdl-menu__container').css('position', 'fixed');
    });

    
    
</script>

<!-- MathJax Load-->


<!-- Bing Background -->


<script type="text/ls-javascript" id="lazy-load">
    // Offer LazyLoad
    queue.offer(function(){
        $('.lazy').lazyload({
            effect : 'show'
        });
    });

    // Start Queue
    $(document).ready(function(){
        setInterval(function(){
            queue.execNext();
        },200);
    });
</script>

<!-- Custom Footer -->



<script>
    (function(){
        var scriptList = document.querySelectorAll('script[type="text/ls-javascript"]')

        for (var i = 0; i < scriptList.length; ++i) {
            var item = scriptList[i];
            lsloader.runInlineScript(item.id,item.id);
        }
    })()
console.log('\n %c © Material Theme | Version: 1.5.0 | https://github.com/viosey/hexo-theme-material %c \n', 'color:#455a64;background:#e0e0e0;padding:5px 0;border-top-left-radius:5px;border-bottom-left-radius:5px;', 'color:#455a64;background:#e0e0e0;padding:5px 0;border-top-right-radius:5px;border-bottom-right-radius:5px;');
</script>

                </main>
            </div>
        </body>
    
</html>
